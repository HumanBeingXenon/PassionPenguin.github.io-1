<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SHOW STATION INFO</title>
    <link rel="stylesheet" href="./assets/styles/styles.css">
</head>

<body>
<div class="app" id="app">
    <div class="mask collapse" id="mask"></div>
    <!-- TOP NAV -->
    <nav class="fixed-top nav search">
        <div class="content">
            <h1>广州地铁车站信息
                <small>Station INFO</small></h1>
        </div>
        <div class="wrap_search">
            <i class="icon icon_search" onclick="system.back()">
                <img src="assets/media/vectors/ic_back.svg" alt="back">
            </i>
            <h2 id="CurrentStation"></h2>
        </div>
    </nav>
    <nav class="position-fixed selectType">
        <div class="active"><span>设备与出入口</span></div>
        <div>车站地图</div>
        <div>维基百科</div>
    </nav>
</div>
<!-- BOTTOM NAV -->
<nav class="fixed-bottom nav navigation">
    <a href="index.html">
        <div class="ripple">
            <img src="./assets/media/vectors/home_black.svg" alt="">
            <span>主页</span></div>
    </a>
    <a href="StationInformation.html">
        <div class="ripple">
            <img src="./assets/media/vectors/info_coloured.svg" alt="">
            <span>车站信息</span></div>
    </a>
    <a href="RouteMap.html">
        <div class="ripple">
            <img src="./assets/media/vectors/map_black.svg" alt="">
            <span>运营线网图</span></div>
    </a>
    <a href="Account.html">
        <div class="ripple">
            <img src="./assets/media/vectors/person_black.svg" alt="">
            <span>账号</span></div>
    </a>
</nav>
<div id="stationinfWrap" class="collapse">
    <div class="inner">
        <div class="p_content">
            <div class="innerData"></div>
        </div>
    </div>
</div>
</body>
<script src="./assets/scripts/lib.min.js"></script>
<script src="./assets/database/stationinf.js"></script>
<script src="./assets/database/stationlist.js"></script>
<script src="./assets/database/stationnum.js"></script>
<script src="./assets/database/stationplat.js"></script>
<script>
    var linedata = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "13", "14", "21", "GF", "APM"];
    var routedirection = [["广州东站方向", "西塱方向"], ["嘉禾望岗方向", "广州南站方向"], ["天河客运站方向", "机场北方向", "机场北/天河客运站方向", "体育西路方向", "番禺广场方向", "体育西路/番禺广场方向"], ["黄村方向", "南沙客运港方向"], ["文冲方向", "滘口方向"], ["香雪方向", "浔峰岗方向"], ["大学城南方向", "广州南站方向"], ["文化公园方向", "万胜围方向"], ["高增方向", "飞鹅岭方向"], ["新沙方向", "鱼珠方向"], ["东风方向", "镇龙方向", "嘉禾望岗方向", "新和方向"], ["增城广场方向", "员村方向"], ["新城东方向", "沥滘方向"], ["林和西方向", "广州塔方向"]];
    var globallist = ["Line1-GZ", "Line2-GZ", "Line3-GZ", "Line4-GZ", "Line5-GZ", "Line6-GZ", "Line7-GZ", "Line8-GZ", "Line9-GZ", "Line13-GZ", "Line14-GZ", "Line21-GZ", "Line-GF", "LineAPM-GZ"];

    function cE(type) {
        return document.createElement(type);
    }

    function openURL(href) {
        window.location.href = href;
        // $.ajax({
        //     url: href,
        //     type: 'POST',
        //     cache: false,
        //     success: function (result) {
        //         $('#app').html(result);
        //         window.history.pushState({href: href}, '', href);
        //         if (href === "StationInformation.html") {
        //             let a = $("#stationlist a");
        //             for (let i = 0; i < a.length; i++) {
        //                 let e = a[i];
        //                 e.onclick = function () {
        //                     let d = e.childNodes[1];
        //                     choosePlatform(s_num[linedata.indexOf(d.childNodes[1].innerText)][parseInt(d.childNodes[3].innerText) - 1])
        //                 }
        //             }
        //         }
        //     }
        // });
    }

    function openINF(num, platnum) {
        // window.location.href=""
    }

    function animateIt(selector, name, type) {
        if (typeof (selector) === "object" && selector.length !== 1) {
            selector.forEach((e) => {
                $(e)[0].style.display = type;
                $(e)[0].classList.add(name);
                setTimeout(function () {
                    $(e)[0].classList.remove(name);
                }, 750);
            });
            return 0;
        }
        $(selector)[0].style.display = type;
        $(selector)[0].classList.add(name);
        setTimeout(function () {
            $(selector)[0].classList.remove(name);
        }, 750);
    }

    function bounceInLeft(selector) {
        if (typeof (selector) === "object" && selector.length !== 1) {
            selector.forEach((e) => {
                $(e)[0].style.display = "block";
                $(e)[0].classList.add("animation_bil");
                setTimeout(function () {
                    $(e)[0].classList.remove("animation_bil");
                }, 750);
            });
            return 0;
        }
        $(selector)[0].style.display = "block";
        $(selector)[0].classList.add("animation_bil");
        setTimeout(function () {
            $(selector)[0].classList.remove("animation_bil");
        }, 750);
    }

    function bounceOutRight(selector) {
        if (typeof (selector) === "object" && selector.length !== 1) {
            selector.forEach((e) => {
                $(e)[0].classList.add("animation_bor");
                setTimeout(function () {
                    $(e)[0].style.display = "none";
                    $(e)[0].classList.remove("animation_bor");
                }, 750);
            });
            return 0;
        }
        $(selector)[0].classList.add("animation_bor");
        setTimeout(function () {
            $(selector)[0].style.display = "none";
            $(selector)[0].classList.remove("animation_bor");
        }, 750);
    }

    function showstationinf(num, platformnum) {
        $("#stationinfWrap")[0].classList.add("show");
        let json = s_inf.inf;
        let table = cE("div");
        table.id = "inftable";
        let p_num = s_plat[num][platformnum][1];
        let door = [["GF", "4", "6"].includes(p_num) ? 4 : p_num === "13" ? 8 : p_num === "APM" ? 2 : 6, ["1", "2", "8"].includes(p_num) ? 5 : ["4", "5", "6"].includes(p_num) ? 3 : p_num === "APM" ? 2 : 4];
        for (let i = 1, k = 1; i <= door[0]; i++) {
            for (let j = 1; j <= door[1]; j++, k++) {
                let res = "";
                if (j === 1)
                    if (i === 1)
                        res += "<div class='first-cabin first-door'>";
                    else res += "<div class='first-door'>";
                else if (j === door[1])
                    if (i === door[0])
                        res += "<div class='last-cabin last-door'>";
                    else res += "<div class='last-door'>";
                else res += "<div>";
                res += "<div id='door_" + k + "'></div><div>" + k + "</div></div>";
                table.innerHTML += res;
            }
        }
        let d = $("#stationinfWrap .innerData")[0];
        d.innerHTML = "";
        d.appendChild(table);
        let data = s_inf[num].inf[platformnum];
        let f = data.facilities;
        for (let i = 0; i < f.length; i++) {
            let res1 = "<span class='facilitiesgroup'><span class='exitnum'>" + f[i][2] + "</span>";
            if (f[i][1].indexOf(1) !== -1)
                res1 += "<span class='escalator'></span>";
            else if (f[i][1].indexOf(2) !== -1)
                res1 += "<span class='staircase'></span>";
            else if (f[i][1].indexOf(3) !== -1)
                res1 += "<span class='elevator'></span>";
            res1 += "</span>";
            let res2 = typeof (f[i][3]) !== "undefined" ? "<span class=\"font-" + f[i][3] + " border-" + f[i][3] + " interchange\"><span class=\"insideborder\">" + linedata[globallist.indexOf(f[i][3])] + "</span></span>" : "";
            $("#door_" + f[i][0])[0].innerHTML += "<span>" + res2 + res1 + "</span>";
        }
        $("#CurrentStation")[0].innerHTML = f_s_list[num][0] + " <small>" + f_s_list[num][1] + "</small>";
    }

    /**
     * @return {string}
     */
    function GET_(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    showstationinf(GET_("num"), GET_("platnum"));

</script>
</html>