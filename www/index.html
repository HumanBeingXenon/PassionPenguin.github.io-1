<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Main Page</title>
    <link rel="stylesheet" href="./assets/styles/styles.css">
    <link rel="stylesheet" href="./assets/styles/globalstyle.css">
</head>
<body>
<div class="app" id="app">
    <!-- TOP NAV -->
    <div class="mask collapse" style="z-index:1032" id="Searchmask"></div>
    <!-- TOP NAV -->
    <nav class="fixed-top nav search">
        <div class="content">
            <h1>广州地铁车站信息
                <small>Version 1.2 BETA</small></h1>
        </div>
        <div class="wrap_search">
            <i class="icon icon_search">
                <img src="assets/media/vectors/ic_search.svg" alt="search"></i>
            <label for="searchStation"></label>
            <input type="text" id="searchStation" placeholder="您想要前往...">
            <button class="btn bg_primary">搜索</button>
        </div>
        <div class="p_content" id="SearchRes">
            <div class="glacier_search">
                <ul id="dropdown">
                </ul>
            </div>
        </div>
    </nav>
    <!-- MAIN CONTENT -->
    <div class="main-content container stationinfo">
        <div class="card card-body" id="platformChoserWrap">
            <div class="inner">
                <div class="selectLine">
                    <h1>请选择您的乘车方向
                        <small>Select Your Platform</small></h1>
                    <div class="innerData"></div>
                </div>
                <span data-target="#platformChoserWrap" id="closePlatformChoser">×</span>
            </div>
        </div>
        <a href="">
            <img class="banner" src="assets/media/images/banner_rm_white.png" alt="RMBanner">
        </a>
    </div>
</div>
<!-- BOTTOM NAV -->
<nav class="fixed-bottom nav navigation">
    <a href="index.html">
        <div class="ripple">
            <img src="./assets/media/vectors/home_coloured.svg" alt="">
            <span>主页</span></div>
    </a>
    <a href="StationInformation.html">
        <div class="ripple">
            <img src="./assets/media/vectors/info_black.svg" alt="">
            <span>车站信息</span></div>
    </a>
    <a href="RouteMap.html">
        <div class="ripple">
            <img src="./assets/media/vectors/map_black.svg" alt="">
            <span>运营线网图</span></div>
    </a>
    <a href="Account.html">
        <div class="ripple">
            <img src="./assets/media/vectors/person_black.svg" alt="">
            <span>账号</span></div>
    </a>
</nav>
</body>
<script src="assets/scripts/lib.min.js"></script>
<script src="./assets/scripts/lib.min.js"></script>
<script src="./assets/database/stationlist.js"></script>
<script src="./assets/database/stationnum.js"></script>
<script src="./assets/database/stationplat.js"></script>
<script>
    GET_('dark')==="true"?document.documentElement.classList.add('dark-theme'):void(0);
    if (window.matchMedia("(prefers-color-scheme: dark)").matches || document.documentElement.classList.contains("dark-theme")) {
        let r = $("img");
        for (let i = 0; i < r.length; i++) {
            r[i].src.indexOf("white") !== -1 ? r[i].src = r[i].src.replace(/white/, "black") : r[i].src = r[i].src.replace(/black/, "white");
        }
    }

    $(function () {
        $(function () {
            let res;
            let d = document.getElementById("searchStation");
            let o = document.getElementById("dropdown");
            d.oninput = function () {
                if (d.value !== "") {
                    $("#SearchRes")[0].style.display = "block";
                    $("#Searchmask")[0].style.display = "block";
                } else {
                    $("#SearchRes")[0].style.display = "none";
                    $("#Searchmask")[0].style.display = "none";
                }

                o.innerHTML = ""; // Clear Dropdown Data 清空下拉数据
                res = []; // Clear Data 清空数据
                let k = d.value;
                f_s_list.forEach(element => {
                    element[0].search(new RegExp(k, "ig")) !== -1 || element[1].search(new RegExp(k, "ig")) !== -1 ? res.push(f_s_list.indexOf(element)) : void (0);
                });
                res.forEach(element => {
                    let li = document.createElement("li");
                    let a = document.createElement("span");
                    let b = document.createElement("span");
                    a.classList.add("Chinese");
                    b.classList.add("English");
                    a.innerHTML = f_s_list[element][0].replace(new RegExp(k, "gi"), "<b class='Highlight'>" + k + "</b>");
                    b.innerHTML = f_s_list[element][1].replace(new RegExp(k, "gi"), "<b class='Highlight'>" + k + "</b>");
                    li.appendChild(a);
                    li.appendChild(b);
                    li.onclick = () => choosePlatform(element);
                    o.appendChild(li);
                });
            }
        });
    });


    function animateIt(selector, name, type) {
        if (typeof (selector) === "object" && selector.length !== 1) {
            selector.forEach((e) => {
                $(e)[0].style.display = type;
                $(e)[0].classList.add(name);
                setTimeout(function () {
                    $(e)[0].classList.remove(name);
                }, 750);
            });
            return 0;
        }
        $(selector)[0].style.display = type;
        $(selector)[0].classList.add(name);
        setTimeout(function () {
            $(selector)[0].classList.remove(name);
        }, 750);
    }

    function bounceInLeft(selector) {
        if (typeof (selector) === "object" && selector.length !== 1) {
            selector.forEach((e) => {
                $(e)[0].style.display = "block";
                $(e)[0].classList.add("animation_bil");
                setTimeout(function () {
                    $(selector)[0].style.display = "block";
                    $(e)[0].classList.remove("animation_bil");
                }, 1250);
            });
            return 0;
        }
        $(selector)[0].style.display = "block";
        $(selector)[0].classList.add("animation_bil");
        setTimeout(function () {
            $(selector)[0].style.display = "block";
            $(selector)[0].classList.remove("animation_bil");
        }, 1250);
    }

    function bounceOutRight(selector) {
        if (typeof (selector) === "object" && selector.length !== 1) {
            selector.forEach((e) => {
                $(e)[0].classList.add("animation_bor");
                setTimeout(function () {
                    $(e)[0].style.display = "none";
                    $(e)[0].classList.remove("animation_bor");
                }, 750);
            });
            return 0;
        }
        $(selector)[0].classList.add("animation_bor");
        setTimeout(function () {
            $(selector)[0].style.display = "none";
            $(selector)[0].classList.remove("animation_bor");
        }, 750);
    }
    var linedata = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "13", "14", "21", "GF", "APM"];
    var routedirection = [["广州东站方向", "西塱方向"], ["嘉禾望岗方向", "广州南站方向"], ["天河客运站方向", "机场北方向", "机场北/天河客运站方向", "体育西路方向", "番禺广场方向", "体育西路/番禺广场方向"], ["黄村方向", "南沙客运港方向"], ["文冲方向", "滘口方向"], ["香雪方向", "浔峰岗方向"], ["大学城南方向", "广州南站方向"], ["文化公园方向", "万胜围方向"], ["高增方向", "飞鹅岭方向"], ["新沙方向", "鱼珠方向"], ["东风方向", "镇龙方向", "嘉禾望岗方向", "新和方向"], ["增城广场方向", "员村方向"], ["新城东方向", "沥滘方向"], ["林和西方向", "广州塔方向"]];
    var globallist = ["Line1-GZ", "Line2-GZ", "Line3-GZ", "Line4-GZ", "Line5-GZ", "Line6-GZ", "Line7-GZ", "Line8-GZ", "Line9-GZ", "Line13-GZ", "Line14-GZ", "Line21-GZ", "Line-GF", "LineAPM-GZ"];

    function openINF(num, platnum) {
        window.location.href = "./ShowStationInformation.html?num=" + num + "&platnum=" + platnum;
    }
    function choosePlatform(num) {
        animateIt(".mask", "fadeIn", "block");
        bounceInLeft("#platformChoserWrap");
        $(".mask")[0].onclick = function () {
            setTimeout(function () {
                animateIt(".mask", "fadeOut", "none")
            }, 500);
            bounceOutRight("#platformChoserWrap");
        };
        $("#closePlatformChoser")[0].onclick = function () {
            setTimeout(function () {
                animateIt(".mask", "fadeOut", "none")
            }, 500);
            bounceOutRight("#platformChoserWrap");
        };
        let a = "";
        let p_num = s_plat[num];
        for (let i = 0; i < p_num.length; i++) {
            a += "<a class='dropdown-item' href='javascript:void(0)' onclick='openINF(" + num + "," + i + ")'>";
            let b = p_num[i][0];
            let rd;
            if (b === "7") rd = "仅供下车";
            else if (b === "8") rd = "仅供上车";
            else if (b === "9") rd = "终点站台";
            else if (b === "10") rd = "不启用（快车越行或备用）";
            else rd = routedirection[linedata.indexOf(p_num[i][1])][b - 1];
            let globalname = globallist[linedata.indexOf(p_num[i][1])];
            a += "<i class='platformnum font-" + globalname + " border-" + globalname + "'><span>" + (i + 1) + "</span></i><span class='vertical-middle'> 站台 " + rd + "</span></a>";
        }
        $("#platformChoserWrap .innerData")[0].innerHTML = a;
    }
</script>
</html>